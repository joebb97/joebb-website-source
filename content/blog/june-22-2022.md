---
title: "In Soviet Russia, Golang JSON Unmarshal You"
date: 2022-06-22
author: "Joey"
---

# You heard me

Golang's `encoding/json` library wants to make your life sad.

It's so enticing. So friendly. It walks up to you at a bar and gives you a nice smile. You didn't even have to fuck with some insane directory structure called `site-packages` or 

```
go/src/github.com/please/end/my/life/gomodules.txt/jk-its/actually-a-directory/site-packages/usr/local/bin/sadness
```

But when you're not looking, that slimey little library is going to change the type of your `interface{}` inside a struct without you even noticing they queued Despacito 10 times on the mfin' jukebox. 

(Sorry for the swears [but also not sorry, it's just me mang], I've been watching a lot of my spirit animal [AvE](https://www.youtube.com/user/arduinoversusevil) on YouTube as of late and I really relate to his Ingl√©s).

## Allow me to explain

At werk I was doing some stuff related to the Layer7 Happy Land called WEB APIs. 

Specifically, autogenerating API clients based on something called an [OpenAPI specification](https://spec.openapis.org/oas/latest.html).

These specifications have you define your Web Application's routes, i.e `/holy-shit/youcan-do-a-post-request-here`, as well as the content of said POST request mentioned in the cheeky little routey mabobber. This makes doing code generation of both the client-side and server-side of your Web Application eeezy peezy. A common framework for doing this is [Swagger](https://swagger.io/).

I had to codegen some Golang clients, which might make you say, "JOEY, THERES A GITHUBBY [SCHWANG THANG](https://github.com/go-swagger/go-swagger) that does that!" 

To which I'd say, keep it in your pants ya mansplainer. I work at an Enterprise. We can't be having a boat load of code floating around that we don't understand (it's a joke because that's like all working at an Enterprise is, but it's desirable to understand where ur schtuff came from).

...,,,,... <- It's the Golang
{{< rawhtml >}}<s>walrus</s>{{< /rawhtml >}}!

## I want Options

No. You goddamn business bros. Berkeley business bros. Not the stock Options. Gosh. Give it a rest with the whole money thing for two seconds and go watch the Sunset over Lake Michigan.

Anyhoo. Sometimes we want to support HTTP requests that have optional paramaters. I.e sometimes we have

```json
{
    "yourReply": 88.0,
    "optionalObject": {
        "sadField": "happyValue",
        "alsoOptional": "becauseWhyNot?"
    }
}
```

other times we have

```json
{
    "yourReply": 88.0,
}
```

How should a flip flappin Golang HTTP-wrapping client handle this? I'm told Jeffrey Bezos' minions have designed an AWS Golang Client that uses pointers, which shore did make me cackle. Many Fs thrown in the chat over that design decision.

At the time, I wasn't allowed to use Generics because Rob Pike and the rest of the Plan9 memers decided that wasn't necessary for Google's self-taught English Majors to scale their Surveillance Capitalism to arbitrary Nines of avalability. Also, I love the fact that self-taught English Majors end up working at Google, I'm expressing discontent towards Rob Pike's decisions to think they can't handle the wonderfulness that is metaprogramming!

# My approach

* We obviously have to have some recursive `struct`s/JSON Objects, called Models (the OpenAPI term for them) generated.
* Upper-level Models can have `{primitives, Leaf Models}`
* Leaf Models have only `primitives`, hence why they're leaves.
* We have to support Optionality for both
